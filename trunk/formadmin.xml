<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="formadmin.xml"
    description=""
    author_affiliation="Capgemini"
    height ="50">
    <Require feature="idi"/>
    <Require feature="locked-domain" />
	<Require feature="dynamic-height"/>
	<Require feature="setprefs" />
  </ModulePrefs>


 <Content type="html">
    <![CDATA[
	<script src="https://www.google.com/jsapi" type="text/javascript"></script>
	<script type='text/javascript' src='https://bbva-sercoeco.googlecode.com/svn/trunk/js/jquery-1.9.1.min.js'></script>
	<script type='text/javascript' src='https://bbva-sercoeco.googlecode.com/svn/trunk/js/jquery-ui-compilation2.js' ></script>
	<script type='text/javascript' src='https://bbva-sercoeco.googlecode.com/svn/trunk/js/jquery.ui.selectmenu.js'></script>
    <link rel='stylesheet' type='text/css' href='https://bbva-sercoeco.googlecode.com/svn/trunk/js/jqueryui.css' media='screen'/>
	<link rel='stylesheet' type='text/css' href='https://bbva-sercoeco.googlecode.com/svn/trunk/js/bbva-components-forms.css' media='screen'/>
	
	<style type="text/css">
	  
	</style>

<select name="anyo" id="anyo" onChange="checkLock(this.options[this.selectedIndex].value);">
      <option value="2024">2024</option>
      <option value="2023">2023</option>
      <option value="2022">2022</option>
      <option value="2021">2021</option>
      <option value="2020">2020</option>
      <option value="2019">2019</option>
      <option value="2018">2018</option>
      <option value="2017">2017</option>
      <option value="2016">2016</option>
      <option value="2015">2015</option>
      <option value="2014">2014</option>
      <option value="2013">2013</option>
	  <option value="A単o" selected="selected">---A単o---</option>
      </select><br><br>
      <label> Bloquear entrada de datos </label> <input type="checkbox" name="lock" id="lock" /><br>
      <div id="envio"></div>
	  
	  	
	
	
<script type="text/javascript">
 
 function checkLock(yearLock){
    var urlTable = "https://docs.google.com/spreadsheet/ccc?key=0Arxw5OOmF_fQdHRza0RUbzZPbEJUTzZXbGo1eEpDVXc";
	var gadgetHelper = null;
	google.load("visualization", "1", {"packages": ["table"]});
	gadgetHelper = new google.visualization.GadgetHelper();
	var opts = {dataType:'jsonp'};		
	var query = new google.visualization.Query(urlTable, opts);
	var querytosend = "select C,S where C like('%"+yearLock+"%') limit 1";
	query.setQuery(querytosend);			  
	query.send(handleQueryResponse);
 
 }
function handleQueryResponse(response) {
		data = response.getDataTable();	
				if(data.getValue(0,1)!="X"){
				    document.getElementById('envio').innerHTML='<button onclick="sendForm();"  value="Enviar" >Enviar</button>';
					var anyo = data.getValue(0,1);
					return alert("A単o "+anyo+" No bloqueado");
				}else{
					document.getElementById('envio').innerHTML="";
					var anyo = data.getValue(0,1);
					return alert("A単o "+anyo+ "ya bloqueado");
				
				}
				
			
			}
 
 function respuesta(){
 alert("Hola");
 }
   
 function sendForm(){
   var anyo = $("#anyo").val();
   var params ="anyo="+anyo;
  $.ajax({
  type: "GET",       
  url: "https://script.google.com/macros/s/AKfycbz3MFQJy8jFwcEUDeRqdB91VSVaW__r8iyFkvPbpQzWZ-h_GtE/exec",
  contentType: 'application/json',
  dataType: 'jsonp',
  data: { anyo: anyo,
  prefix: "respuesta"}
  })  
  .success(function(  ) {
		alert( "Data Saved: ");
	});
  } 

   
   </script>

	

   

 ]]>
 </Content>
</Module>